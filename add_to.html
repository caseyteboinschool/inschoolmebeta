<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Use it just like an app!</title>
  <style>
    :root { --radius: 14px; }
    * { box-sizing: border-box; }

    /* Backdrop */
    #a2hs-backdrop {
      display: none; /* toggled to block via JS */
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 9998;
    }

    /* Centered modal */
    #a2hs-modal {
      position: fixed;
      z-index: 9999;
      inset: 50% auto auto 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      width: min(92vw, 420px);
      border-radius: var(--radius);
      box-shadow: 0 12px 36px rgba(0,0,0,0.25);
      display: none; /* toggled to block via JS */
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden;
    }

    #a2hs-header {
      padding: 16px 20px;
      border-bottom: 1px solid #eee;
      font-weight: 700;
      font-size: 18px;
    }

    #a2hs-body {
      padding: 16px 20px 8px;
      line-height: 1.35;
      font-size: 16px;
    }

    /* tiny share icon styling */
    #a2hs-body svg.share-icon {
      width: 18px;
      height: 18px;
      vertical-align: -3px;
      margin: 0 4px;
      fill: #0b66ff;
    }

    #a2hs-actions {
      display: flex;
      gap: 10px;
      padding: 16px 20px 20px;
    }

    .btn {
      flex: 1;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      font-weight: 600;
      font-size: 16px;
      touch-action: manipulation;
      cursor: pointer;
    }
    .btn-primary {
      background: #0b66ff;
      border-color: #0b66ff;
      color: #fff;
    }

    /* iOS safe area so it never feels stuck near the home bar */
    @supports(padding: max(0px)) {
      #a2hs-modal { 
        margin-bottom: max(0px, env(safe-area-inset-bottom));
        margin-top: max(0px, env(safe-area-inset-top));
      }
    }

    /* Accessibility: reduce motion */
    @media (prefers-reduced-motion: no-preference) {
      #a2hs-backdrop.show { animation: fade .18s ease-out; }
      #a2hs-modal.show { animation: pop .18s ease-out; }
      @keyframes fade { from {opacity: 0} to {opacity: 1} }
      @keyframes pop {
        from {opacity: 0; transform: translate(-50%, -46%) scale(.98)}
        to   {opacity: 1; transform: translate(-50%, -50%) scale(1)}
      }
    }

    /* Optional: bottom-sheet style for very short viewports */
    @media (max-height: 520px) {
      #a2hs-modal {
        inset: auto 0 0 0;
        transform: none;
        width: 100%;
        border-radius: 16px 16px 0 0;
      }
    }

    /* Hide platform-specific blocks by default; JS will toggle */
    .platform { display: none; }
  </style>
</head>
<body>

<!-- Backdrop + Modal -->
<div id="a2hs-backdrop"></div>
<div id="a2hs-modal" role="dialog" aria-modal="true" aria-labelledby="a2hs-title">
  <div id="a2hs-header"><span id="a2hs-title">Use it just like an app!</span></div>
  <div id="a2hs-body">
    <div id="android-block" class="platform">
      After your child joins, you can add this to your Home Screen like an app!
    </div>

    <div id="ios-block" class="platform">
      Use it just like an app!
      <ol style="margin:8px 0 0 20px; padding:0;">
        <li>
          Tap the <strong>Share</strong> icon
          <!-- Inline iOS-style share icon -->
          <svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 16c-.55 0-1-.45-1-1V6.41l-3.29 3.3a.996.996 0 11-1.41-1.41l5-5c.39-.39 1.02-.39 1.41 0l5 5a.996.996 0 11-1.41 1.41L13 6.41V15c0 .55-.45 1-1 1z"/>
            <path d="M5 20c-1.1 0-2-.9-2-2V9c0-.55.45-1 1-1s1 .45 1 1v9h12V9c0-.55.45-1 1-1s1 .45 1 1v9c0 1.1-.9 2-2 2H5z"/>
          </svg>
          at the bottom of Safari.
        </li>
        <li>Select <strong>Add to Home Screen</strong>.</li>
      </ol>
    </div>
  </div>
  <div id="a2hs-actions">
    <button id="a2hs-ok" class="btn btn-primary" type="button">Okay, thanks!</button>
  </div>
</div>

<img src="logo.png" width="346" height="88" alt=""/>
<script>
  // Elements
  const backdrop = document.getElementById('a2hs-backdrop');
  const modal = document.getElementById('a2hs-modal');
  const btnOk = document.getElementById('a2hs-ok');
  const androidBlock = document.getElementById('android-block');
  const iosBlock = document.getElementById('ios-block');

  // Detect platform & install state
  const ua = navigator.userAgent.toLowerCase();
  const isIos = /iphone|ipad|ipod/.test(ua);
  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone;

  let deferredPrompt = null;

  function showModal(which) {
    // which: 'ios' | 'android'
    androidBlock.style.display = which === 'android' ? 'block' : 'none';
    iosBlock.style.display = which === 'ios' ? 'block' : 'none';

    backdrop.style.display = 'block';
    modal.style.display = 'block';

    // trigger animations
    backdrop.classList.add('show');
    modal.classList.add('show');
  }

  function hideModal() {
    backdrop.style.display = 'none';
    modal.style.display = 'none';
    backdrop.classList.remove('show');
    modal.classList.remove('show');
  }

  // iOS: show instructions if not installed
  if (isIos && !isStandalone) {
    // Slight delay so it doesn't collide with Safari UI
    setTimeout(() => showModal('ios'), 600);
  }

  // Android/Chrome: use beforeinstallprompt
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    showModal('android');
  });

  // Single button behavior
  btnOk.addEventListener('click', async () => {
    // Android: trigger native prompt if available
    if (deferredPrompt) {
      deferredPrompt.prompt();
      try {
        await deferredPrompt.userChoice;
      } catch (_) {}
      deferredPrompt = null;
    }
    // Close either way
    hideModal();
  });

  // Optional: dismiss if user taps outside the modal
  backdrop.addEventListener('click', hideModal);

  // Optional: log successful install
  window.addEventListener('appinstalled', () => {
    console.log('[A2HS] Installed');
  });
</script>
</body>
</html>
